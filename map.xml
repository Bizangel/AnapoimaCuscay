<krpano>	

	<layer name="stateHolder" keep="true" state="2f3h"  /> <!-- Possible are 2f3h 2f2h 1f3h 1f2h (2f3h > 2 floor 3 habs ) -->
	
	<!-- Also update general pano state, call on each loadscene -->
	
	<action name="updateRadar" scope="local" args="spot_n">
		calc(spotname, 'spot' + spot_n);
		set(layer[radar].parent, get(spotname));
		set(layer[radar].heading, get(layer[get(spotname)].facing) );

		if((spot_n GE 17) AND (spot_n LE 21),
			switchFloor(2);
			,
			switchFloor(1);
		);
		
		if(layer[stateHolder].state == '2f3h' OR layer[stateHolder].state == '1f3h',
			set(hotspot[room3hotspot].visible, true);
			,
			set(hotspot[room3hotspot].visible, false);
		);
	</action>
	
	<action name="switchFloor" scope="local" args="nfloor"> 
		if(nfloor == 1,
			<!-- Set proper map -->
			if(layer[stateHolder].state == '2f3h',
				set(layer[map].url,%ROOT%/f2_3h.png);,
			layer[stateHolder].state == '2f2h',
				set(layer[map].url,%ROOT%/f2_2h.png);,
			layer[stateHolder].state == '1f3h',
				set(layer[map].url,%ROOT%/f1_3h.png);,
			layer[stateHolder].state == '1f2h',
				set(layer[map].url,%ROOT%/f1_2h.png);,
			);
			
			<!-- Enable 1st layers -->
			for(set(i,1), i LE 16, inc(i), 
				set(layer[calc('spot' + i)].visible, true);
			);  
			<!-- Disable 2nd layers -->
			for(set(i,17), i LE 22, inc(i), 
				set(layer[calc('spot' + i)].visible, false);
			);  
			
			<!-- Enable 3hab spot if availble -->
			if(layer[stateHolder].state == '2f3h' OR layer[stateHolder].state == '1f3h',
				set(layer[spot22].visible, true);
				,
				set(layer[spot22].visible, false);
			);
			
			,
			set(layer[map].url,%ROOT%/floor2.png);
			<!-- Disable 1st layers -->
			for(set(i,1), i LE 16, inc(i), 
				set(layer[calc('spot' + i)].visible, false);
			);  
			<!-- Enable 2nd layers -->
			for(set(i,17), i LE 21, inc(i), 
				set(layer[calc('spot' + i)].visible, true);
			);  
			<!-- Disable 3hab spot -->
			set(layer[spot22].visible, false);
		);
		

	</action>
	
	
	
	<action name="switchHouse" scope="local" args="houseState">
		set(layer[stateHolder].state, get(houseState) );
		tour_loadscene(get(xml.scene));
	</action>
	
	<layer name="radar" keep = "true" url.flash="%SWFPATH%/plugins/radar.swf" url.html5="%SWFPATH%/plugins/radar.js" align="center" zorder="1" scale.mobile="2.3" fillalpha="0.5" scale="1"
 fillcolor="0x7F5F3F" linewidth="1.0" linecolor="0xE0E0A0" linealpha="0.5" editmode="true" />
	
	<action name="mapspot_onclick" scope="local">
		tour_loadscene(get(caller.linkedscene), null, MERGE, BLEND(0.5));
	</action>
	
	<layer name="map" y="16%" x="50" url="floor1hab3.png" keep="true" handcursor="false" type="container"
	capture="false" align="leftbottom" scale="0.2" scale.mobile="0.11" scalechildren="true" bgcapture="false"/>
	
	<style name="mapspot" keep="true" url="greendot.png" parent="map" align="lefttop" edge="center" scale.mobile="2.5"
	onclick="mapspot_onclick();"/>
	
	<layer name="spot1" style="mapspot" x="1085" y="1045" zorder="1" linkedscene="room1" facing="-90"/>
	<layer name="spot2" style="mapspot" x="1280" y="1062" zorder="1" linkedscene="room1_bath" facing="200"/>
	<layer name="spot3" style="mapspot" x="1339" y="998" zorder="1" linkedscene="room1_shower" facing="150"/>
	<layer name="spot4" style="mapspot" x="1682" y="1142" zorder="1" linkedscene="room2" facing="205"/>
	<layer name="spot5" style="mapspot" x="1449" y="1063" zorder="1" linkedscene="room2_bath" facing="150"/>
	<layer name="spot6" style="mapspot" x="1595" y="873" zorder="1" linkedscene="room2_outside" facing="140"/>
	<layer name="spot7" style="mapspot" x="1152" y="873" zorder="1" linkedscene="room1_outside" facing="140"/>
	<layer name="spot8" style="mapspot" x="1458" y="1360" zorder="1" linkedscene="parking" facing="50"/>
	<layer name="spot9" style="mapspot" x="558" y="884" zorder="1" linkedscene="bbq" facing="150"/>
	<layer name="spot10" style="mapspot" x="842" y="870" zorder="1" linkedscene="living" facing="-110"/>
	<layer name="spot11" style="mapspot" x="685" y="1223" zorder="1" linkedscene="kitchen" facing="-30"/>
	<layer name="spot12" style="mapspot" x="841" y="548" zorder="1" linkedscene="pool_front" facing="160"/>
	<layer name="spot13" style="mapspot" x="685" y="37" zorder="1" linkedscene="pool_back" facing="-80"/>
	<layer name="spot14" style="mapspot" x="1373" y="184" zorder="1" linkedscene="grassfield" facing="-50"/>
	<layer name="spot15" style="mapspot" x="786" y="1341" zorder="1" linkedscene="dishes_view" facing="215"/>
	<layer name="spot16" style="mapspot" x="1017" y="1167" zorder="1" linkedscene="entrance_hallway" facing="210"/>
	
	<layer name="spot17" style="mapspot" x="642" y="1270" zorder="1" linkedscene="second_floor_corner" facing="0"/>
	<layer name="spot18" style="mapspot" x="944" y="276" zorder="1" linkedscene="second_floor_pool_view" facing="-85"/>
	<layer name="spot19" style="mapspot" x="818" y="1024" zorder="1" linkedscene="room_second_floor" facing="-90"/>
	<layer name="spot20" style="mapspot" x="1218" y="1018" zorder="1" linkedscene="room_second_floor_bath" facing="90"/>
	<layer name="spot21" style="mapspot" x="1216" y="796" zorder="1" linkedscene="room_second_floor_shower" facing="-45"/>
	
	<layer name="spot22" style="mapspot" x="1744" y="1048" zorder="1" linkedscene="room3" facing="-90"/>
	
</krpano>